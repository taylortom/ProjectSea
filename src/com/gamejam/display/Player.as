package com.gamejam.display {	// Flash imports	import com.gamejam.managers.SoundManager;	import com.gamejam.models.GameModel;	import com.gamejam.utils.map;	import com.gamejam.display.GameObject;	import com.gamejam.views.GameView;	import flash.display.MovieClip;	import flash.display.Stage;	import flash.events.Event;	import flash.events.KeyboardEvent;	import flash.geom.Point;	import flash.ui.Keyboard;		/**	 * Player class - movement controlled by keyboard, stores values for temperature and movement	 * @author Kev Adsett	 */	public class Player extends GameObject	{		//player states		private var birth : int = -1;				private var _states : Array;		private var _state : int;				private var _movementDirection : int;		private var _moveable:Boolean = true;		private static var LEFT : int = -1;		private static var STILL : int = 0;		private static var RIGHT : int = 1;		private const FALLING_SPEED : int = 5;				private var xVel : Number = 0.0;		private var maxVel : Number = 20.0;				private var health : int = 2;		private var maxHealth : int = 2;				private var temperature : int = 0;		private var returnSpeed : int = 10; // number of frames needed to return temperature by 1		private var returnTimer : int = 50; // frames before temperature starts returning to 0		private var returnCounter : int; // temperature return frames elapsed so far		private var returning : Boolean = false;				private var playedDeathSound : Boolean;				public function Player() 		{			super();			_init();		}				private function _init():void 		{			_states = new Array(7);			//trace("Player::_init");						var totalRange = GameModel.timeForPlayerToDie * 2;			var timePerState = totalRange / 6;			trace("timePerState: " + timePerState);			var roundingBuffer = 0.1;			for (var i = -GameModel.timeForPlayerToDie; i < GameModel.timeForPlayerToDie + roundingBuffer; i += timePerState)			{				var mappedIndex = Math.ceil(map(i, -GameModel.timeForPlayerToDie, GameModel.timeForPlayerToDie+roundingBuffer, 0, 6));				_states[mappedIndex] = Math.round(i);			}			trace("_states: " + _states);						var _stage : Stage = GameView.getInstance().stage;			this._changeState();						_stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyboardDown);			_stage.addEventListener(KeyboardEvent.KEY_UP, onKeyboardUp);					}				override protected function onUpdate(e:Event):void 		{			if (this._moveable)			{				_move();				returnCounter ++;								if (returnCounter >= returnTimer && temperature != 0)				{					if (returnCounter % returnSpeed == 0) returnTemperature();				}			}			this._updateScreenCoords();		}				private function onKeyboardDown(e:KeyboardEvent):void 		{			//trace("e.keyCode: " + e.keyCode);			if (e.keyCode == Keyboard.LEFT)			{				_movementDirection = LEFT;			}			else if (e.keyCode == Keyboard.RIGHT)			{				_movementDirection = RIGHT;			}		}				private function onKeyboardUp(e:KeyboardEvent):void 		{			_movementDirection = STILL;		}				public function kill():void		{			trace("Player.kill");						/*			1. Play death animation			2. (at the end of the animation) remove eventlisteners & destroy movieclip			3. Respawn at top of screen(?)			*/		}		public function returnTemperature():void		{			if (temperature > 0) temperature --;			if (temperature < 0) temperature ++;			returning = true;			this._changeState();		}				public function increaseTemperature():void		{			returnCounter = 0;			temperature = Math.round(temperature);			temperature++;			returning = false;			this._changeState();		}				public function decreaseTemperature():void		{			returnCounter = 0;			temperature = Math.round(temperature);			temperature--;			returning = false;			this._changeState();		}				private function _changeState(): void		{			//trace("_changeState()");						var sm:SoundManager = SoundManager.getInstance();						if (temperature < _states[0]) temperature = _states[0];						if (temperature > _states[6]) temperature = _states[6];			trace(temperature);			var state:String = "";			switch(temperature)			{				case _states[0]: 					if (!playedDeathSound)					{						sm.playEffect(new Frozen());						playedDeathSound = true;					}					this._moveable = false;					GameView.getInstance().camera.paused = true;					state = this.getStateAsString(temperature);					break;				case _states[1]:					sm.playEffect(new Freeze());					state = this.getStateAsString(temperature);					break;				case _states[2]:					sm.playEffect(new Freeze());					state = this.getStateAsString(temperature);					break;				case _states[3]:					sm.playEffect(new Droplet1());					state = this.getStateAsString(temperature);					break;				case _states[4]:					sm.playEffect(new Boil());					state = this.getStateAsString(temperature);					break;				case _states[5]:					sm.playEffect(new Boil());					state = this.getStateAsString(temperature);					break;				case _states[6]:					if (!playedDeathSound)					{						sm.playEffect(new Boiled());						playedDeathSound = true;					}					this._moveable = false;					GameView.getInstance().camera.paused = true;					state = this.getStateAsString(temperature);					break;			}			// play the relevant animation			if (state != "") this.gotoAndPlay(state);				// update the temp gauge			GameView.getInstance().tempGauge.update(temperature);		}				override protected function _move():void 		{			switch(_movementDirection)			{				case LEFT:					if (xVel > -maxVel) xVel-=2;					break;				case RIGHT:					if (xVel < maxVel) xVel+=2;					break;				case STILL:					if (xVel < 0) xVel+=2;					else if (xVel > 0) xVel-=2;					break;			}			if (GameModel.getInstance().started)			{					this.rotation = -xVel;				this.position.x += xVel;				this.position.y += this.FALLING_SPEED;			}		}				public function getStateAsString(numericState: Number):String		{			if (!returning)			{				switch(numericState)				{					case _states[0]: 						return "frozen";					case _states[1]:						return "freezing2";					case _states[2]:						return "freezing1";					case _states[3]:						return "water";					case _states[4]:						return "boiling1";					case _states[5]:						return "boiling2";					case _states[6]:						return "boiled";					default:						trace("Player.getStateAsString: Unknown state: " + numericState);						return "";				}			}			else			{				switch(numericState)				{					case _states[1]:						return "freezing1";					case _states[2]:						return "water";					case _states[3]:						return "water";					case _states[4]:						return "water";					case _states[5]:						return "boiling1";					default:						trace("Player.getStateAsString: Unknown state: " + numericState);						return "";				}			}			return "";		}	}}